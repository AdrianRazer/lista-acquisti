<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Lista Acquisti</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f8f8; }
    h1 { text-align: center; color: #50c878; }
    #form { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    #form input, #form button { padding: 8px; font-size: 14px; }
    #list { margin-top: 20px; }
    .item { background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;
        display: flex; align-items: center; gap: 10px; cursor: grab; border-left: 5px solid #50c878; }
    .item img { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
    .item span { flex-grow: 1; }
    .item.bought { opacity: 0.6; text-decoration: line-through; }
    button.delete { background: red; color: white; border: none; padding: 5px; border-radius: 4px; cursor: pointer; }
    button { background: #50c878; color: white; border: none; border-radius: 4px; cursor: pointer; }
</style>
</head>
<body>

<h1>üõí Lista Acquisti</h1>

<div id="form">
    <input type="text" id="name" placeholder="Nome oggetto">
    <input type="number" id="qty" placeholder="Quantit√†" min="1" style="width:80px;">
    <input type="file" id="image" accept="image/*">
    <button onclick="addItem()">Aggiungi</button>
</div>

<div id="list"></div>

<script>
let items = JSON.parse(localStorage.getItem('shoppingList') || '[]');
let dragIndex = null;

function render() {
    const list = document.getElementById('list');
    list.innerHTML = '';
    items.forEach((item, index) => {
        list.innerHTML += `
            <div class="item ${item.bought ? 'bought' : ''}" draggable="true"
                 ondragstart="startDrag(${index})" ondragover="event.preventDefault()"
                 ondrop="dropItem(${index})">
                <input type="checkbox" ${item.bought ? 'checked' : ''} onchange="toggleBought(${index})">
                <img src="${item.img}">
                <span>${item.name} (x${item.qty})</span>
                <button class="delete" onclick="removeItem(${index})">‚ùå</button>
            </div>`;
    });
    localStorage.setItem('shoppingList', JSON.stringify(items));
}

function addItem() {
    const name = document.getElementById('name').value.trim();
    const qty = document.getElementById('qty').value || 1;
    const file = document.getElementById('image').files[0];
    if (!name || !file) return alert("Inserisci nome e immagine");
    const reader = new FileReader();
    reader.onload = function(e) {
        items.push({ name, qty, img: e.target.result, bought: false });
        render();
        document.getElementById('name').value = '';
        document.getElementById('qty').value = '';
        document.getElementById('image').value = '';
    }
    reader.readAsDataURL(file);
}

function removeItem(index) {
    items.splice(index, 1);
    render();
}

function toggleBought(index) {
    items[index].bought = !items[index].bought;
    render();
}

function startDrag(index) {
    dragIndex = index;
}

function dropItem(index) {
    const draggedItem = items.splice(dragIndex, 1)[0];
    items.splice(index, 0, draggedItem);
    render();
}

render();

// Registra il service worker per PWA
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
